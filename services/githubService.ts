export class GitHubService { constructor(private t:string){} async fetch(e:string,o:any={}){ let h = {'Authorization': 'token ' + this.t, 'Accept': 'application/vnd.github.v3+json', 'Content-Type': 'application/json', ...o.headers}; let r=await fetch('https://api.github.com'+e,{...o,headers:h}); if(!r.ok) throw new Error('GitHub Error'); return r.json();} async ensureRepoExists(n:string){let u=await this.fetch('/user'); try{await this.fetch('/repos/'+u.login+'/'+n);}catch(e){await this.fetch('/user/repos',{method:'POST',body:JSON.stringify({name:n,auto_init:true})});}} async pushFiles(n:string,fs:any[]){let u=await this.fetch('/user'); for(let f of fs){let sha; try{let ex=await this.fetch('/repos/'+u.login+'/'+n+'/contents/'+f.path); sha=ex.sha;}catch(e){} await this.fetch('/repos/'+u.login+'/'+n+'/contents/'+f.path,{method:'PUT',body:JSON.stringify({message:'Sync '+f.path,content:btoa(unescape(encodeURIComponent(f.content))),sha})});}} }